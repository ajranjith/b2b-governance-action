<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
  <title>GRES B2B Setup</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wizard">
    <header class="wizard-header">
      <h1>GRES B2B Governance</h1>
      <p class="subtitle">Setup Wizard</p>
    </header>

    <div class="wizard-content">
      <!-- Step 1: Welcome -->
      <section id="step-welcome" class="step active">
        <div class="step-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
        </div>
        <h2>Welcome</h2>
        <p>Set up GRES B2B Governance for your AI agent</p>
        <div class="checklist">
          <div class="check-item"><span class="check-icon">&#10003;</span><span>Auto-detect AI agents</span></div>
          <div class="check-item"><span class="check-icon">&#10003;</span><span>Download & verify binary</span></div>
          <div class="check-item"><span class="check-icon">&#10003;</span><span>Configure MCP connection</span></div>
          <div class="check-item"><span class="check-icon">&#10003;</span><span>Verify handshake</span></div>
        </div>
        <p class="note">No admin rights required</p>
        <div class="step-actions">
          <button class="btn btn-primary" onclick="wizard.start()">Get Started</button>
        </div>
      </section>

      <!-- Step 2: Detect Agents -->
      <section id="step-detect" class="step">
        <h2>Detecting AI Agents</h2>
        <p>Scanning for config files...</p>
        <div id="agentList" class="agent-list"></div>
        <div id="detectStatus" class="note"></div>
        <div class="step-actions">
          <button class="btn btn-secondary" onclick="wizard.back()">Back</button>
          <button class="btn btn-primary" id="btnSyncAll" onclick="wizard.syncAll()" style="display: none;">Sync All</button>
          <button class="btn btn-primary" id="btnDetectNext" onclick="wizard.selectAgents()" disabled>Configure Selected</button>
        </div>
      </section>

      <!-- Step 3: Install -->
      <section id="step-install" class="step">
        <h2>Configuring Environment</h2>
        <p>Setting up the GRES B2B bridge...</p>
        <div class="progress-steps" id="installSteps">
          <div class="progress-step" id="step-download">
            <div class="step-status"></div>
            <div class="step-content">
              <div class="step-title">Downloading Binary</div>
              <div class="step-detail" id="detail-download">Waiting...</div>
            </div>
          </div>
          <div class="progress-step" id="step-checksum">
            <div class="step-status"></div>
            <div class="step-content">
              <div class="step-title">Verifying Integrity</div>
              <div class="step-detail" id="detail-checksum">Waiting...</div>
            </div>
          </div>
          <div class="progress-step" id="step-path">
            <div class="step-status"></div>
            <div class="step-content">
              <div class="step-title">Configuring PATH</div>
              <div class="step-detail" id="detail-path">Waiting...</div>
            </div>
          </div>
          <div class="progress-step" id="step-config">
            <div class="step-status"></div>
            <div class="step-content">
              <div class="step-title">Writing Agent Config</div>
              <div class="step-detail" id="detail-config">Waiting...</div>
            </div>
          </div>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar"><div class="progress-fill" id="installProgress"></div></div>
          <div class="progress-label">
            <span id="installStatus">Preparing...</span>
            <span id="installPercent">0%</span>
          </div>
        </div>
      </section>

      <!-- Step 4: Zombie Guard -->
      <section id="step-zombie" class="step">
        <h2>Restart Required</h2>
        <p>Please close your AI agent to apply changes</p>
        <div class="zombie-alert">
          <h3 id="zombieAgent">Waiting for Agent</h3>
          <p>Close <strong id="zombieProcess">Agent</strong> completely</p>
          <p class="note" id="zombieRestart">Please close and reopen the application.</p>
          <div class="spinner"></div>
          <p class="note" id="zombieStatus">Checking...</p>
        </div>
        <div class="step-actions mt-4">
          <button class="btn btn-danger" id="btnForceKill" onclick="wizard.forceKill()">Force Close</button>
          <button class="btn btn-secondary" id="btnSkipZombie" onclick="wizard.skipZombie()" style="display: none;">Continue Anyway</button>
        </div>
      </section>

      <!-- Step 5: Verify -->
      <section id="step-verify" class="step">
        <h2>Verification</h2>
        <p>Running self-tests...</p>
        <div class="progress-steps" id="verifySteps">
          <div class="progress-step" id="verify-binary">
            <div class="step-status"></div>
            <div class="step-content">
              <div class="step-title">Binary Test</div>
              <div class="step-detail" id="verify-binary-detail">Waiting...</div>
            </div>
          </div>
          <div class="progress-step" id="verify-path">
            <div class="step-status"></div>
            <div class="step-content">
              <div class="step-title">PATH Test</div>
              <div class="step-detail" id="verify-path-detail">Waiting...</div>
            </div>
          </div>
          <div class="progress-step" id="verify-mcp">
            <div class="step-status"></div>
            <div class="step-content">
              <div class="step-title">MCP Handshake</div>
              <div class="step-detail" id="verify-mcp-detail">Waiting...</div>
            </div>
          </div>
        </div>
        <div id="verifyResult"></div>
      </section>

      <!-- Step 6: Success -->
      <section id="step-success" class="step">
        <div class="success-ring">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        </div>
        <h2 class="gradient-text">Governance Active</h2>
        <p>Your environment is configured and verified</p>
        <div class="status-grid">
          <div class="status-item">
            <div class="status-label">MCP Bridge</div>
            <div class="status-value"><span class="status-badge active">Verified</span></div>
          </div>
          <div class="status-item">
            <div class="status-label">Agent</div>
            <div class="status-value" id="successAgent">-</div>
          </div>
          <div class="status-item">
            <div class="status-label">Version</div>
            <div class="status-value" id="successVersion">-</div>
          </div>
          <div class="status-item">
            <div class="status-label">Config</div>
            <div class="status-value" id="successConfig">-</div>
          </div>
        </div>
        <p class="note">A desktop shortcut has been created</p>
        <div class="step-actions">
          <button class="btn btn-secondary" onclick="wizard.openDocs()">Documentation</button>
          <button class="btn btn-primary" onclick="wizard.launchDashboard()">Launch Dashboard</button>
        </div>
      </section>

      <!-- Error State -->
      <section id="step-error" class="step">
        <div class="step-icon error">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
        </div>
        <h2>Setup Failed</h2>
        <div class="error-box">
          <div class="error-title" id="errorTitle">Error</div>
          <div class="error-message" id="errorMessage"></div>
          <div class="error-details" id="errorDetails"></div>
        </div>
        <div class="step-actions">
          <button class="btn btn-secondary" onclick="wizard.retry()">Try Again</button>
          <button class="btn btn-primary" onclick="wizard.openDocs()">Get Help</button>
        </div>
      </section>
    </div>

    <footer class="wizard-footer">
      <span>GRES B2B Governance</span>
      <span id="wizardVersion">v1.0.0</span>
    </footer>
  </div>

  <script src="wizard.js"></script>
</body>
</html>
